#!/usr/bin/python3
# -*- coding: UTF-8 -*-

"""
GLgammascoutsim.py - GeigerLog's Gamma-Scout simulator

use with GeigerLog to simulate responses of a Gamma-Scout device. See more in
the header of file gdev_gscout.py located in the GeigerLog folder.

MUST start as SUDO (!):  sudo ./GLgscoutsim.py

The communication between GL and the Pseudo device is logged into file
GLgscoutsim.log
"""

###############################################################################
#    This file is part of GeigerLog.
#
#    GeigerLog is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    GeigerLog is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with GeigerLog.  If not, see <http://www.gnu.org/licenses/>.
###############################################################################

"""
# check ports with:  stty -F /dev/pts/5
                     stty -F /dev/ttyS90

#cstopb=<bool>  Sets two stop bits, rather than one.    # How to use?

#socat -d -d -d -d tcp-listen:4141,reuseaddr,fork file:/dev/ttyUSB0,nonblock,cs8,b9600,cstopb=0,raw,echo=0
#socat -d -d  pty,b9600,cs8,raw,echo=0    pty,b9600,cs8,raw,echo=0 #cs8 ok, cs7 geht nicht

# use sudo to make links
sudo socat -d -d  pty,b9600,raw,echo=0,link=/dev/ttyS90    pty,b9600,raw,echo=0,link=/dev/ttyS91
# but then it needs these commands:
sudo chmod 777 /dev/ttyS91
sudo chmod 777 /dev/ttyS90
# obgleich das schon erfÃ¼llt sein sollte:
# lrwxrwxrwx 1 root root       10 Sep  7 11:56 /dev/ttyS90 -> /dev/pts/2
# lrwxrwxrwx 1 root root       10 Sep  7 11:56 /dev/ttyS91 -> /dev/pts/4
"""

__author__          = "ullix"
__copyright__       = "Copyright 2016, 2017, 2018, 2019, 2020"
__credits__         = [""]
__license__         = "GPL3"

import sys, os, io, time, datetime
import subprocess
import serial                       # serial port
import serial.tools.list_ports      # allows listing of serial ports


# Data from file: GammaScout20190819_212150.dat

otherdata="""
Version 6.10 d93683 4f07 19.08.19 21:20:01

b0 07 0078
0b000000a4f8a29c3b01
48010000450783fa1c02
77040000db06fcf91c02
ce110000ca6918fe7602
de5a0000eb26b5fb5802
9e050100df1f27ff6702
e0ff1f00bf038efdb202

"""

dumpdata = """GAMMA-SCOUT Protokoll
f5ef3718140819f50c000200010005000100030003000400020004000300020087
030002000800000003000400010003000300010004000200030003000700040033
02000300040003000100030003000600060002000400040007000400030004003b
020004000200020006000300020002000400050006000500020004000600010038
040004000500040003000400030001000400020005000300020002000100020031
02000200030005000300010002000600000003000200030004000400030001002c
060002000100020003000400030004000900030005000200010001000500030036
070007000300040001000200020005000400040002000100030003000400040038
03000400050003000200010001000300050003000700030003000700030007003c
070005000300050001000200030003000600080006000200040007000700020047
030006000100040005000400000009000500020006000400050005000300040042
04000200010009000300040004000300040005000200020003000400080004003e
05000300050003000700040005000200030003000200040003000500030002003b
04000400010002000200020008000600050004000200020003000600040005003c
010003000300020005000600050005000400040005000300040001000300010037
02000400020006000200050001000300070001000100040000000200010003002c
000002000700040003000400020003000300070005000300040005000300010038
070004000400050002000700020005000400030001000600050003000500040043
09000400050003000500020003000100050002000400030004000300020004003b
07000300070005000300050006000700050004000400020006000300010006004a
040007000200090004000600010004000600040003000200030003000900030046
040005000600010003000600020005000400030006000500010007000400030041
01000600050002000300050001000300030007000200020006000600050002003b
010002000500050004000600020004000100050003000500030001000600030038
000002000300040002000700010003000400050006000200010003000400020031
050001000100050006000400020001000500010001000400020003000800080039
02000500030001000800030003000300020004000600050000000800020005003c
04000400060002000800020002000400050002000400040004000100080003003f
020007000300050004000400020006000300030003000400020003000300000036
060002000700040005000200030007000500030000000500080004000800040049
020001000400040003000200050003000400080004000000070003000000020034
05000300030003000300030005000900050002000300020003000400050000003a
050004000100020001000400030002000200070007000400070005000200010039
030004000600050003000700040004000500040006000100030006000300070047
05000100030001000500030004000300060002000300040003000500080004003c
08000100010002000500040003000300050003000600050004000200050002003b
040001000600020004000400030000000300030000000400030004000300050031
030004000200030001000300030006000200050003000300040003000500050037
020002000200030003000100040006000500060002000600040003000200060039
06000300050003000500040002000400030002000200010006000700040003003c
040008000000040004000100050003000300040005000200080004000700020040
040004000400030004000300010004000100060003000300060006000100020037
05000500030004000300010008000300060008000100030001000400030001003b
020002000200020004000000030008000a0003000200060004000000040007003b
020004000300020001000600000007000600010004000400040006000300020037
030003000800060003000500040006000400020007000000010005000400040041
03000300040003000000070006000400040006000600010004000400040004003f
000004000400020006000300020006000300030001000100050003000300080036
030002000300050004000200030002000500070002000400040002000400010035
040004000300060007000500030001000300050005000200030004000600040041
020002000400040005000700040008000700060005000600020005000400010048
030006000a00020002000700020002000300050005000500050001000700020043
020005000300080007000200030005000400020006000400030007000700040048
030004000300030006000400070005000100050002000500090004000400070048
05000100030004000300010006000200030005000300030005000600060004003c
040003000400050007000800040003000100020005000300040008000800030048
04000200050004000300050005000a00030003000600040007000900040005004f
02000700020006000400050003000300030004000600020003000200030005003c
03000500030006000a0004000100040002000b0003000400030004000500050049
040003000700020000000100060003000500030001000500040004000400030037
08000300060005000300040004000900080005000300040005000800020002004f
03000300040008000600040002000300040001000400020006000400050004003f
030004000600050003000400050003000100050006000200070003000400040041
02000400050003000200040005000300040003000500060006000400030003003e
02000600050005000200030002000300070002000300050007000300030004003e
030007000600060004000700060001000700030003000300000006000500020045
02000500040007000600050006000100030001000300060001000400050003003e
040006000200030003000600050003000300030004000400020001000300020036
01000500050003000600020003000400020006000100040003000a00030003003d
05000300040002000700050003000400030005000300000004000400020007003d
02000400020007000300020007000500030001000300050004000400070004003f
010005000200080003000500040003000600040004000200020003000200010037
05000400040005000500010003000200050000000400020006000700070000003c
030003000600020003000300030000000200020003000600040003000200040031
040007000700020006000300050005000400030003000200040004000300050043
07000400070004000600050004000200090005000500050001000400060001004b
05000300040003000700020002000100020004000500050002000500040005003b
02000400050003000300050004000500010003000800070006000200010002003d
050004000200020003000300030005000300040003000200030004000300030034
030002000500040006000200010005000200030002000300030006000300020034
040001000200030003000300030004000400040005000400010006000300060038
05000500030000000500050005000100040006000400010001000400070003003b
03000200020003000700010005000600020005000500010006000200080005003f
030002000200060003000800040003000300030004000800030005000500030041
03000300040004000100010003000600040007000600050005000500040002003f
02000300040002000300030006000400040005000200060006000300040006003f
030005000300020004000400020004000300000006000300040002000300070037
060007000400030002000800070007000400070004000700030002000400060051
030008000500030006000300010007000100050006000600020003000100060042
050003000400040007000500040003000200050005000400050003000300050043
010002000200010002000a0002000300020005000200020001000200060004002f
030004000800020004000500020003000500020004000200030003000500020039
02000400050004000700040004000200030001000400070003000100000008003b
04000800060003000200050003000400070004000100030001000300030006003f
08000300010009000100090005000500030004000400040009000100040004004a
0a000400070007000700010003000100060004000100060006000600020007004e
040001000000030006000700040005000300040001000500010003000400020035
080005000900040003000500080006000600050005000400040002000000060050
020004000200020002000200040007000400040004000400040002000500050039
010006000500030007000200040006000a00070004000100070002000200050048
06000300040005000600050002000300020002000200040004000200030009003e
06000500040006000300010001000a00030000000400020003000500060004003f
050000000300030005000500040005000300010001000100040004000400030033
020002000400040000000200030003000300060005000300020007000300060037
07000600020005000400060005000900020007000300060004000300040005004e
05000400050001000400040005000100040006000300060000000400070003003e
040005000400020002000400070005000c0005000400020003000400020009004a
06000300050003000400050004000300050007000200030002000300040003003e
010006000400050003000500030007000200040005000400040006000300050043
030005000600070002000400020008000300070007000300060006000100020048
030003000800010003000300020006000200030002000600020005000200050038
010003000300060004000300040004000600060003000500060006000100030040
050004000400060000000500070005000300080002000200040006000300050045
05000700020002000400040002000100050005000400010004000200050006003b
02000300030006000700040001000300020003000100050007000300060004003c
0400020001000c0003000100020004000400090003000200020002000400020039
03000200000004000200030000000100040002000400050002000500040006002f
060004000200060003000600040007000300030004000200040005000700050047
02000600020003000500040002000400010008000500050002000500030004003d
050009000200030001000500030002000600050003000000010005000300010036
040000000500030003000300040002000500030003000400020006000400060039
03000300030003000400040003000400070005000300050004000400020005003e
050003000300040003000200030005000500070003000400050002000200010039
090004000300030003000400050004000400030005000300040005000500030043
04000600050003000600050005000200050005000100020004000500020002003e
06000500050004000200020005000300040001000300020007000400020003003a
02000100060003000200050004000500050004000500050002000300020005003b
040004000300080004000500030005000500060001000800020002000700020045
03000500020002000600040007000400010005000400040004000300030005003e
03000500030004000100010003000600040005000500060001000300050006003d
040002000300020005000400040003000100030005000400040006000300030038
020005000000020004000800030006000400040007000200030003000900090047
04000100070003000100040003000300040008000400040006000400030004003f
00000200020003000100020006000300010005000400030003000300040004002e
050005000400050005000200080003000500030004000400040001000400020040
020003000500030001000600010002000500040006000100000006000300080038
060003000600040006000700010004000500030004000300000005000700020042
020000000200020004000400020003000800030005000200070002000600030037
05000400040003000400040003000400040005000100040009000300010003003d
06000600040005000800060002000400020005000500020005000100060008004b
06000700010003000200060006000800080003000400020001000500070005004a
050002000300060003000400050003000200080004000100050001000200020038
050004000200010005000400050007000300060009000400040001000400060046
030005000700020005000100040003000400080006000300050005000100030041
02000500050005000100070002000300070002000400020002000600040004003d
030000000300030001000400070001000100070007000500040005000100040038
03000300020002000400050003000500060004000300040000000500090001003b
06000a00030005000300040004000300020002000100040002000500020004003c
04000400020001000000040006000200020003000100010004000400050004002f
05000200020000000400030004000200060009000700050004000200030002003c
0200000004000300030008000300000003000300070002000300050007000a003f
060003000600040005000500050003000500030005000200040002000300040041
0200040003000300050004000a0002000500010008000300040007000500020044
04000300030005000500050004000500020004000100020003000700050001003b
03000500050003000600030003000500020005000300040007000000030004003d
03000200020008000200030006000400040003000500060002000300060002003d
05000100030003000600020004000500040002000500050003000400040002003a
040003000100040003000300010005000400010004000600040002000400070038
030000000400030004000600030003000100020001000100080004000500030033
050003000600010005000500020003000700060005000500060002000400040045
050004000500040005000500090003000300030003000100020006000800060048
060003000400060004000500000004000300090001000500070006000400020045
02000100080002000500060005000400040004000100050000000500030005003c
04000600060008000200040001000200000005000300020004000500040002003a
01000100030003000500020003000300010001000200010003000700020005002b
020006000700050005000500040004000100040006000300020004000400080046
04000600030003000500050005000300050003000500050005000100020002003e
03000400020004000500030003000500080003000200030003000300050007003f
000007000100050003000600020004000500070003000500030001000600060040
060003000500050003000200020003000300050001000300040002000300050037
03000500010005000400020007000200030005000600030004000a00000003003f
02000300020002000200040002000700040005000600040003000300040006003b
02000200020004000700060002000300060002000300040006000300030006003d
06000300030004000200040005000400030003000300050002000700020005003d
01000400040005000200060005000200080005000100030002000400020006003c
03000400010004000000060004000500050003000300060006000200030006003d
040003000600020000000200020003000400080004000300020004000500050039
04000300020004000500010001000500050004000400040004000200060004003a
070002000400040001000300050003000600010005000400000004000400010036
02000200020006000300050004000200030005000200040006000800030003003c
040004000500020001000100050002000400030006000400030003000200070038
02000500050003000500020001000300020000000300050000000200010003002a
040005000400070004000400060003000100060004000600010008000400010044
020002000100040003000300030006000200020003000600030004000400030033
040004000400060009000500000002000400070002000500010002000500060042
01000600050005000800040004000600010002000400040003000200060001003e
07000300050005000300030004000200020001000500040004000300030005003b
030002000300050005000300030003000200050001000200050004000600010035
02000600070001000500040005000300040003000300030003000300030004003b
040006000600060004000300040004000a0002000200010005000100000003003d
050005000300040005000300030004000800060006000b00060006000300030051
040002000400030003000200040002000300020001000400020005000300080034
04000200040003000200070005000100070002000400030003000500050006003f
050003000600070004000200050002000200040003000600030005000600040043
010001000200020003000200040000000100070002000500070007000200040032
060005000700040003000700060003000400060003000600030004000100020046
020004000700020005000400030005000300010006000200050002000400010038
020004000300030002000400030005000400050004000300040003000200010034
05000300050005000300020004000200040003000400030006000600050003003f
050002000500030005000500010005000700060004000400030002000500050043
060002000600020007000100070004000400040002000100040001000100030037
020003000600030002000800010004000300070004000800050005000600030046
040004000800060002000600040006000300030004000300030004000600030045
030004000700020002000300030004000500040001000200030005000300040037
04000300020001000400050004000400040004000500010006000200060004003b
020007000500030001000400040005000100040001000700050006000200070040
060006000600010003000600040007000500040007000400040007000600050051
030003000300080009000300060004000500050003000400040004000300020045
030001000200040002000200040003000100060007000300050003000400010033
020003000500040003000000020003000500040007000700060007000100060041
05000800080003000100020003000700020003000300050001000300040005003f
040004000200030004000200050004000400070008000100040008000500060047
030005000900030004000900010006000200060002000300040002000200070044
02000200060003000200050004000200060003000100080002000600060004003e
040003000500020004000400060003000800030006000300040007000900000047
03000800030005000400050005000600050003000500060008000300030003004b
02000900030003000200020003000200050004000100060002000500030008003c
02000300040004000400030005000300030006000100040001000a000200010038
020002000300030005000200040000000100010006000700060002000500040035
060002000100030005000700020002000300040004000400020004000500010037
02000400080006000300030002000200040007000100050001000200060002003a
00000100020000000300030003000000010001000500000003000100030001001b
060004000100020007000100020001000500020005000100050004000400040036
05000300030004000300040002000000060002000600070002000400070005003f
040005000500060005000800030003000300040004000600040001000100020040
080001000100020005000300060002000000010002000400010001000500070031
050004000200040008000200050003000300040004000300020003000400010039
06000200040002000500040005000400040002000500040004000200030004003c
05000800050002000200050004000400040001000400050001000600020003003d
0200030004000400020003000400060004000100030004000a0002000200030039
060002000400050005000400030003000600060004000500050005000300040046
040002000400060006000600030006000500050005000500040006000100040048
050008000500010003000400070008000400080001000200060005000200030048
06000400040006000200030002000400040002000500030007000200050002003d
050004000300050005000400010002000500040005000300070003000400050041
020002000500050004000300060005000300020003000200020005000300040038
030008000600010006000500060004000000040003000800030004000200040043
05000600040003000200030004000300060003000300040005000100000006003a
050006000200020002000800030003000500080004000500020005000400030043
090004000300060003000400030003000200030006000400070004000400050046
03000300010005000300030002000100050008000400020005000800020006003d
06000400030004000300030003000400050008000200050003000400030003003f
040002000400020003000400010005000100040004000400040005000600030038
050003000300010005000200050002000100020004000300050003000400050035
020001000100030002000100010005000300000002000400040003000600030029
030002000400030007000700040005000300040003000700020004000200040040
060001000500050002000500050004000400030008000500030003000500050045
06000400030004000800060002000400060005000800020008000500010002004a
02000000050004000400050001000500050002000600050000000600040005003b
090003000400040004000300040004000300040000000400090004000700040046
050003000300040004000300030003000500040001000600040004000200020038
070006000100040001000800070007000400010004000300030005000200020041
08000200020003000200040001000500010008000400060003000200070003003d
05000600040003000200040006000400030003000700050004000200010003003e
030002000100030004000600010006000600040000000300040003000000020030
01000200040004000100080001000400020003000600050003000400080002003a
010009000600080003000200070007000500010002000300060004000400030047
05000400030002000500030003000200050004000500020007000300020004003b
06000100050005000200040007000400050005000a00050003000400020006004a
0400040005000a0003000500040004000300070006000900040003000300070051
020004000100070005000300010006000400040004000400010005000300010037
020002000700030002000300030000000400050002000100060004000200050033
02000700000006000400070006000200030004000300000001000200070005003b
020006000300040002000500050005000500080002000400040003000200050041
02000300050007000500020004000400020006000100070005000100040003003d
030003000400050002000300020008000300020002000500040003000100010033
0300030006000600070007000300030006000500010005000a0001000400030049
07000700030005000700040006000a00020007000500050001000500030002004f
040003000000050004000200020005000600030000000400040003000600020035
020002000800040006000600070003000100050004000600050003000100040043
06000500040003000300020003000400050003000300060002000200030004003a
030001000200050007000500060003000300040003000400030001000400030039
010004000300070000000300060001000400050002000200050003000100040033
050001000100040004000300020006000600050004000200030001000400050038
080003000300030001000200010004000300060004000200060003000300010035
030005000500020005000500050001000600030003000100040008000400060042
030005000d0004000300030004000700060002000500050003000500050006004f
03000400000007000200010000000300030002000100020002000300070006002e
030003000200050004000600010002000300020004000400030002000600030035
04000500020004000200030003000500040008000200050004000400040003003e
01000600020005000200030003000300050002000300010001000200050000002c
040006000500060006000200030001000200050003000800060003000500070048
00000500060008000400030002000300070002000100040002000300030006003b
02000200040003000200070005000400020006000700050007000100030003003f
030005000400020004000200040004000200020002000400010003000600050035
030005000000050003000400030003000300020002000200090003000100030033
060005000600060001000600030001000100040004000400080001000700060045
020005000700030002000300050005000600060004000100050007000300050045
03000300050003000300020003000500090005000400040001000400020003003b
050001000200010004000400060007000300060003000400070003000500030040
03000400050003000300050008000200040002000400010004000400060004003e
04000500020009000700050001000500030006000200090006000800040003004f
030004000200040002000100030004000500050003000300050006000400030039
04000300020006000a00040005000700050004000600040004000400030005004c
0a000300070005000500050004000300070006000200040006000100050004004d
02000200050005000100020006000200050004000600020007000500040004003e
040005000700020001000700020005000300040006000300020007000500040043
050003000500030002000100010003000100020002000200050005000300070032
03000100050006000200040003000400060005000500030004000500050002003f
040003000200030005000100030002000400020003000200030008000400050036
03000400010004000000050002000300020002000400050003000100030004002e
000003000200050003000600090003000600030003000600050003000500050043
04000300020001000300020007000600000005000700030002000500060002003a
01000200030002000300090003000200020005000600060002000200070003003a
040002000500040003000500020001000900050007000300060004000200040042
02000400030003000b00020008000400050006000700050001000500040007004d
00000700040004000100030005000200010004000400040003000600040007003b
050002000300060001000600020003000400030006000600040003000400070041
01000800050007000300040005000000040006000200020003000700030002003e
080003000200030002000200070006000200060006000100020004000300070040
04000500050003000500000003000100040008000400040004000400040003003d
040002000700030002000300030004000100030002000600010004000600030036
060004000400020005000100040000000400030002000500060002000400050039
03000400000004000300040007000600020001000200050004000200060005003a
01000900030004000300040007000700030003000200030002000700030001003e
030005000500040002000500040004000400030002000500070006000300040042
030004000800050002000300050007000500020006000700050004000200030047
020002000700040005000700050004000200080006000000030001000600030041
050009000600010002000100050005000600040004000600030002000a0005004a
040003000400030004000700050005000400040005000500010002000600030041
050004000100040003000400030000000400020002000500060003000300020033
040001000500050002000400060006000300020002000100010006000300050038
03000300030007000200040003000400050003000500010002000600040003003a
020002000600000007000300040004000300080003000600020001000200030038
030004000300020005000300060004000500020002000600040003000100040039
08000400030005000400030001000000030005000500040004000100070005003e
06000400010007000300030004000500020002000500020004000500050001003b
060005000400050007000500020005000400050002000500040002000500020044
050007000200050006000300040006000300050004000800040006000300020049
00000300010004000300040007000200060004000500040005000500030003003b
03000300050003000500020005000500030003000400030006000700040002003f
030005000500040005000200010002000200010005000500040005000400030038
040001000300030004000700050006000100010004000200060001000100030034
01000100090003000000050003000600020007000500050004000400030004003e
03000700040003000000020002000300030004000400030006000600030009003e
01000300040004000400060005000400010004000600060004000300040001003c
040002000500040004000400060004000500050006000300050002000400010040
01000100090002000200020002000600010005000600020001000000010004002d
050004000400030002000500030002000300020004000600030005000200000035
020004000600060004000200040003000200010006000300040009000700040043
030004000500050004000400040007000500010004000400080005000400020045
040005000700030005000300010005000a0004000300020003000200030002003e
020003000700020005000600040006000300030002000700070006000400060049
050002000300030006000200040005000400010000000800050003000300020038
01000600050003000500050003000200040003000100030004000800050003003d
05000400060004000100030003000600020005000500040003000100040003003b
030005000500050003000200030005000400070004000600020005000200070044
030003000100040004000a0003000300030002000600040005000100040005003d
030005000300040003000400050006000600060001000800050002000200040043
040005000500020005000500030007000600020004000500020004000300020040
020004000300060005000200060004000300000007000400030001000300020037
040003000500040003000300020004000000020002000200050006000300040034
000003000300020007000000020004000100020003000100040001000400020027
020004000400080008000300060005000600020003000200060002000300050045
0200060002000500070002000400050001000500050002000a0005000400050046
020003000500080002000800040004000500020006000400060004000200050046
020003000300050004000700000003000200010005000400040002000600030036
030002000300080005000900010002000500060004000300020005000400070045
050001000300040003000400020002000400020003000600020002000600040035
00000800040004000300030002000500060005000600030003000300040004003f
090007000400010004000400050003000500040002000300030003000400070044
040003000100010004000200020005000200030005000400010005000400030031
00000200030005000100050006000600020004000400020006000300080004003d
06000400070003000300030001000300040004000400040006000300000004003b
060006000500060004000300040006000400040002000300040002000900000044
0400010002000200070004000300090004000a00050007000a0007000700020054
05000500050007000400050005000300050003000300070008000500040001004b
03000200000005000500020009000100030005000600030005000500040004003e
06000400060006000700090001000700050007000700060004000300080004005a
030006000400030005000400030002000800060003000200060004000300040042
04000600050005000500060007000500060007000400060006000600060006005a
040005000800070003000600040008000300040001000300030003000600040048
05000700050004000c000400050005000000010002000500060002000700010047
030009000600040004000700000002000400040006000500040002000300040043
06000600090004000300050004000800070008000500030004000700060006005b
080003000200050008000400050005000600070005000400060005000600050054
08000800080002000700040002000400040008000500030005000200040004004e
06000500050002000400020003000400080005000600050004000300040009004b
0700060004000300070004000a0007000200040004000500060003000600040052
03000400080003000500050004000300040004000800040006000500030006004b
050006000800010005000800060005000400050005000c000200080004000a005e
050007000600050008000400060002000800060002000800040002000a0008005b
060004000500070008000300060001000200050007000300070007000600050052
08000600030003000800050001000300050007000900030004000500040002004c
09000200020006000700030005000700060002000900040007000300010006004f
08000600070005000700020005000300040002000400050004000500060002004b
040002000100050005000200030005000400050005000300040003000200020037
050005000100030001000300080003000200000004000300040002000400060036
06000600090004000000040006000300010004000600030004000300020002003f
040003000500070002000700080004000300000002000200060006000000050040
010004000300050003000600010004000300040006000000040004000600030039
07000700040009000400020005000300060005000600050005000300020004004d
070005000600050004000300010004000600040005000200020005000600050046
030007000500010004000400030002000200030008000100020005000100040037
020001000100050003000400040003000500020002000400060004000300050036
020005000300040008000400040009000100060002000200080004000100010040
070004000200010008000600010002000300040007000500030008000200060045
070008000500040003000500020002000200060008000200060005000300030047
050004000400030004000300050002000400030003000300040006000500060040
080003000800050005000600040008000300070007000400060005000500030057
020005000500060000000400070004000400050003000600030005000800050048
070006000500030003000200060004000300040005000400020005000200050042
020003000600040005000300010002f5ee00000000f50a0035003c002e003700d2
2a002d0027003f002b0037002a003100380032003f00380038002b0032002e001e
36002c00310029002f002b002f002c003300240033002d003800230024003400db
2b0043002a002b00370030002d0041002f002f0019003600180011001f001900a6
120015001e0017001e001900140017001e001d0016001a00150012001400200084
14001c001d0011001c000f0011001e001400160013001a00120018001900170069
1a0015001f00120019001b0013001500100019001c0017001400190010001f0074
170015001b001a000d0013001c0015001c001b001d001300170013001700180072
1900140017001d001e00170011001100170016001a0016001a001c0015001e007e
1b001e002000130012001a00170012001b0018001500180017001700150019007d
140013001a001f001c001c0016000e0013001b0017002000210018001e00190091
1b001600160014001300150015001a001f0012001600160013001c0021001a0079
1b0017001a001b0012001f001000210016001900190014001a001e000f00150081
1b00130019001e00180016001f001b0018001400180015001a001800150022008f
1600180015001c0023001d001b001800220013001a001f001b001d0017001d00ac
1d0013001c0015001900200018001d0019001c001600130016000f001800170081
0d001d001700160020001100100013001200170012001000190019001900140055
1c0016001a0017001d000d001e001900150017001e001a001900210016001f0097
14001900200016001700120014001800150018001f001900100019001c0018007a
16001c00190014001100160017001700170016001400150019001f00150013006a
150019001b00150018001b0018001c001300120016001c001a0017001300130073
120010001600120012001d00150013001600150018001900250021001700160070
10001a0019001f0014001200190014000f00160017001c0019001a001500220077
19001b001b00180012001100130015001600120013001b0020001900170017006f
0a001e0016001a001a0018001a00190016001d0015001400200013001d000e0077
1a001c001a001800210011001a00160016001b001b001a001d00100014001b008c
180013001b0019001500130012001700160018001e00150017001b00140012f55e
ee02000007f500f5eea3000272f50c000100060002000600050002000300010001
040005000300050006000300020002000200020005000300030000000200020031
080005000300020005000400060003000000060002000100040004000400070040
050003000500010006000700090002000300060002000400030009000500030049
0400020008000200090002000400040006000200000007000300060005000b004b
030006000400050003000300060003000800040005000400040003000300040044
03000500070001000300070002000500050003000600040003000300030001003d
04000400040006000200050007000200040002000300090008000200080005004b
040003000600030005000100050005000300050005000400070004000400080048
040005000400030003000400040005000100050003000400040003000300020039
010003000100040002000400040002000200080006000400010004000300040035
070002000600050006000500040006000200050002000200030006000300020042
080003000500090004000500030002000400040002000a00040003000200050049
010005000100030004000400010005000100060006000200020002000100060032
020003000300040005000700040004000500030005000800050003000400080049
0500030003000b0004000500060005000400080004000200030002000400040049
060001000400060005000200060003000500020004000500040006000200040041
05000000080006000700030007000600040004000600010006000400060002004b
030004000200030002000500040006000b00090006000300030001000600010045
05000200040002000200040007000400020001000200030000000100030005002f
050004000400000008000800020002000400040004000500010005000400050041
04000700050001000500010002000500060004000400010002000300030006003b
05000500040003000300020006000600070003000200020004000200030004003d
050008000700050003000400010004000400020001000600020006000400030041
030005000100020001000400040001000100040005000700040005000200070038
030004000600030004000400030005000200030003000500020001000a00060040
030007000400040002000100050003000400090007000400040003000200090047
04000500080002000200030002000600030005000100040003000700030001003b
01000300020004000400050007000300060001000200040004000900020004003d
060007000200080003000500040003000200020007000500050007f5ee00000025
05f500f5eeed19265ff50a003e00d200ea00ec00fa010f00fc00ec00ed00db0007
f4010400e400ef010e010c00ec00f500f900d600f500ef00f3f5ee040000adf5f8
0525142509f5eee2001cc4f5042d0624ce0d8c0d930d5c0da10d5b0d660d820ef7
560d5b0d5f0db60daef5eee3010787f50a001e002b003200310029003300300034
310021003000280032002e002c0023002d0029002400200033002e002b003100b0
2f002c0034002f002a003c002700230029002b002f002800230034002d002c00c9
2700280025003800250026002c0030002f002f002e0030003a002d002e003500d9
2c00320025003200370027002f003100260026002d0038002b00210033002c00cf
2f00250029002c002500350024002e0035003e003100290032002e0031003200e5
2e002c00270038002f00310030002200320031002800320031002c0025002e00d8
230032002a002b00320029002f002c003400270029002d002f00320033002200c7
30002b002f002600360029002a0031002a003d002800300025002e002e002600d0
2d0031002500210020002c0031003b002c002e0028003a0032002f002e001f00c6
2e002500270033002c0031002300340026002f002b0026002b0025002e003000b5
250029002d0030003200300022003800270028002e0033002c00260027002c00bc
240038003300300035002d0023002100270037002a003100300030002a002800d0
26002b002e002a00370032002d0030002a003000350026002900350023002a00cf
23002c00280026002a002f002f0025002d002200320034002a002d0028003300b1
210031001d0027002f002a002c00300033003e0026002a003700310043002800df
28002300300022002b0027002800310038002a0030002b002c00310032001d00b1
22002d0032002e00290026002b001f003000350036002d003400320029003900d8
240032002e0025001d00290021002f00300029002d00270031002c002f002e00a6
37002f0026002e002d003200360036002b0033002f002a002c00280033003000f3
2a002a0023002d002700280029002b002f002a003f00350031002f0026003400ce
2600320021002a002d002b003700240035002f0032002d0031002e0035002700d4
3600320034002d002e00340029002e002e002f002b0028002c002d0024002f00de
2d0038003900310034002b0032002e002d002d00360028002e002d0021002b00ed
2a002d00230028002b002c0039002e0022002f002c00310037002a0033002c00ce
2d0028003e002f00290029002a002c002a00310029001d002e002b002e003b00cd
210039002b00330022002900380026002b00260033002b003300260030002500be
360034003500300035002d0032002e002e0033002b00210028002e0030001b00df
30002f00330032002e003000240035002e00350035002a002a00220027002200d2
290030002a0024001400150019001e001b001c0017001a001300140016001e00ca
1b00170010001900150024000b00160014001e0014002000180012000f001b006f
1200110015001700160012001b001d001c0023001c0017001100170015001f007d
1f0014001b00150015001e00160017000d0011001900190012001400190018006a
1b00160016001d001a0020001a0019001d0022001400150018001400180022009f
140014001100250011001c001b0011000e001a0016001300210013001700160069
19001b00190015001b0018001c0015001900100019001200150014001a0022007f
140018001500110016001a00190012001500100016001b0019001400180016005e
0f001300120011001100160017001c001900850043001900240019001b00210012
180012001d001a00200018001d001b0018001500160021001500140015001d0090
110017001c0016000f00170019002100130014001b000d0011001500180014005b
0e001d0017001d0018001d001f00170014001e00160018000d001c001c0010007f
0f00130014000d001c0012001a0015001b00200014001600130018001f001d006c
1a00210019001600150019001100150018001900180011001a0015001b00150077
12001f0018002300120019001300170014001b001b00110016001200120017006d
140016001a001100160014001300180014001300140012001b0015001900190059
110013001800150016001d0013001600160017001800170011001e0013001a0065
1b00180014001600180013001f00170013001500130019001b001200190016006e
1a00120011001500180010001600170012001a001a001b001a0019001a0018006d
150013001c00100014001a0015001b0012001d001a001f0014001700130012006a
22000d00170014001200150016001a00170015001a001000170018001500160061
180016001300160012001d00180012001100170017000b00150015001a00180056
14001600180019001900140019001d0015001a00150017001b001a00140019007b
180019001d0019001600190017001e0016000a001f0021001e0016001e001b0098
0e002400210011001f001a00210011001a00180014001200130017000f00170077
1400200015001b0020001c0021001300170017001d001b0018001300130013008b
110012001e001c001c0024001b001c001a0015001e001e00120017001300160091
19001b00180017001c0018001e001c000e00090018001b001d0017001c0010007b
16001a001200130017001300120019000e0017001b001900180020001a00140069
1a001a0010001a00190019001b001f001a001b00130014001600140010001d007d
20001f001b001f002000220016001600180012001a001700160013001300180096
1a001800100017001d001c0016001b0010001c00130010001800180018001a0074
17001b00130010001900120012001a00120017001a001b0016000e001500160059
12000f0011001600140021001d000c0010000c001c00130013001300100016003d
1400150018001100110016000a0017001b0015001100180018000d0011001d0046
2100180011001b00100019001800100018000f001900130018001400140014005d
18001300170019001300190011002000130018001800190012001e001c00120072
17001f001a0013001700120018001a000e0018001d001e001900110016001a0079
1c001d001600170018001c0015001b001800170014001200210019001600130082
19001b001d00170016000e0017001b001200120012001f001b00210010001d007c
1c00170015001700190011001b001f0017001b0012001d0018001b001b001c008e
14001c0018001f0020001c001b0014001f001900180011001a0022001200160097
200010001300170016001a0016001600170019001400150014001e001a001e0079
1100110015001d0017001600100011001200160011001b00160015001800190052
1e001c001800130012001f001a001f001a00200013001300180012001000200089
1400260016001f00140014001d001c001d00160017001a001d001800100015008e
1900170018001d0015001b001b00110025001f001c001c0012001300150013008a
170015001c0018001e001600110019001000200015002200180016001c001b008a
1c0013001c0018001a001500120014001a0011001400170022001b00170019007b
11001e00130019001a0014001000190018001500190019001c0011001e001c0078
1f001b001d001f001a002c00170015001e001b001d0013001900130015001100a3
120019000c00150019001b0015001b0018001d0014001c00210019002100140084
1a001b00150019001b001f0016001d001d00140017001700140019001400180088
170016000e001200140010001d00150017001d00190016001c0022001300110068
11001f0017001a001000160015001800160014000c0012001500170018001d005d
200013001e001b0016001200140017001a001b0013001c001a00270019000f008c
1200140017001b0011001900230022001e0017001e001b001d00160018000f008f
0f00150016000c0027001c0019001e001b001c00170016001800190012001a0081
1e001500150017001a0019001a00170011001500190017001600170018000f006d
100019001f001d001d00180019001700120022001400170016001e001c0013008c
1b00160017001000120015001c001800170016001600150011001b00140013005e
1500170014001200140014001c001d001a00150016001b0013001500210023007f
140016000e001b001b0012001300180019001d001b001d0017001e0012001a007a
13001c002400150017001b00120018000f00190016001a001d0014001400180079
140015001a0015001f001f00170017001d00120015001a0014001b0011001e0080
16001b001e0016001d001f0019001d0015001a00180015001000160019001c008e
160015001f001b00130023001700210015001a001a0019001f001a0016001d00a1
17001d001600190019001c001c00220016001e001e0015001f00160021001c00af
180011001b001c001400160016000d0021001700130012001d0012001300140060
20001800180015001e001f0010001d001b0013001200130021001c002300130095
1a001b0018001900170011001c00150022001b001f001a00170016001e00160096
1a00130015001b001b00120015002000160013001a0017001e000f001b00140075
18001a001500100015002100150019001f0018001d001c001f001400170017008c
24001d0017001d00170014001d0012001a002000150015001b0017001600180093
200018001a001c001600180019001a0010001f0024001c00110019001300190094
19001c00170013001f0019001b0024001e001500120012001100170019001b0089
1800160010001500180016001200160013001d001a00110017001100190015005a
1f0017001300170015001b001a001d001b0013001d001a001e0019001a00140091
1a00110011001d0018001a00250016001d001c0016001c001d001a0018001e009e
1f0013001b0010001a001a001a0018001600190014001d001b00170018000d007a
190015002100150018001a0018001a0016001800160011001d001b002500170091
150014001900130010001700140025001d001900110019001c0019001800100072
1a001c001b001400150017001b0018001d002600180010001a0010001c001a008f
12001e00190013001e001900180018001e00170015001800160014001d00170083
1e0016002000180017000f0018001400180011001500100013001300190021006c
17001d001800140016001a00140011001f00140014001a000b001e00160017006c
190018001400160014001e001a00190016001800160013001400130018001e0074
140014001800150014001900190013001600130014001500150019001a0017005f
17001d00100016001900160018001800110012001100150014001f00140011005a
220015001500130015001e00180017001a0019001f0017001600180011001a0083
10001700140012002000110014001100130014001a0013000f00100015000e0039
170013000e001c001a0015001400190010001c001c001400120012001f00170066
16001d00190019001c000f00190012000f001e0019001b000c0011001400130060
120013001f001800190016001e0019001d001500190013001a000e0016001b0079
1b00150014000c00130018001b0018001a001c00120019000e001d00210014006f
14000f001e001200160023001c0018001b0013001c001a00130017001d00170082
160015001800130016001a000d001f0016001d001c001e0018001d001500190082
20000f0017001a000e0013001b001a0017001d00180013000f00190017001a006e
1b001c001200190018000f0021001c001b0013001900130017000c001800170072
130013001c0018001300170014001a001400140017001100160015001e0014005f
0e0013001a0018001700170019001300170014001a001c001a0015000e00180063
1b001900160016001700120015001a0019000e001b00150014001900120011005f
160018000e0015001b0018001400170018000e001d001600160018001d0019006c
1600100017001e001a001c000f000f001e001e0016000f001c00120011001c006b
16001b0018001d001c0018001a0018001d000f0012000d001300160016001a0070
1500170012001700120016001500170017001a00160015001a001800230010006a
1a001100160013001d000d001c001800120020001b0016001900120019001d0076
150018001900180017001900150017001a00150013001000250014001f001a007e
1c00160013001b0017001e00160011001b0014001f0016000f0013001e00160076
190011001c001f00140013001000150018001500110011001a001700180011005a
140015000d001b001b001100150014001b0012000a001400190011001a0018004d
140016001b002400110010001000170015001b001900160022001f00180015007e
1600180017001200120020001700180015001900170014001a0014001c0014006f
140018001b001c00170018000c0016000e0014001200100012001b001600170052
200014001a0016001d00150011001c001300190019001b001500190015000f0075
1b0016001300170012001a0015001a001a001a002000140010001300170014006c
1a00190016001300180012001d000f0017001b0019000e001500120011001d0060
1d001b001b00180010001100190015000e0014000d001300160010001d00190058
1e00140017000c00200017000d0011001700100007001a0016000c0021001b0050
15001900140012001a000d001a001b001200120013001a00150014001800170059
1800100016001c0013001a0016001700160019001800140017001d001a00160073
1e0014001200190012002500160018001300180018001c001700190010001b007c
1c00170011001600140017001a0017001000100019001a000e00130013001d005a
13001700170018001b001600190014001700150015001a001e000f001200160067
1e000e0018001800190012000e000e001a00240013001600160018001e00200076
140015001500170021001800120017001e001d0015001b001600130021001a0086
1b0018001e0018001c00150014001c0018001500190014001e001b001600210094
1e0012001800100018001c000f002a001900150015000d00200015001e0016007e
0e0018001b00170014002100120015001600130018001100170018001e0019006c
150017001800140016001500150015001e00180025001a0019001700130016007b
14001a001300140019001e001b00140015000e0012001100210017001600120061
210010001e001600190019001400170015001e00170017001a001a001d00150089
170011001500170013001c00130016001e0015001d001a00160015000f001a006a
17001800130016000d0019001100190016001c0019001b00160019000e0012005d
10002000130019001c001600190015001a00170018001b00170018001a0015007e
16001a0012001f00130019001600170015001a001d001b00160016001400120073
1500170016001d0019001600190013001600140019001d00180015001700120070
16001900170012001800130012001900170023001900140014001400110010005e
0d001b0019001d0012000d001d001a001800160010002000150013001b00120067
1500180015001b0018001800190016001a0019000c001d00130012001b001f0077
180011001e00130019001e00190011001a0017001300170013001a001900180074
1a001c001e001d0019001100c200d600df00dc00e900da00e400d000fd00d30035
"""


print("\n------------------------ GSsimulator.py -------------------------------")
print("--- Executing subprocess.Popen with socat command: ")
mypopen = subprocess.Popen([
                            "socat",
                            '-d',
                            '-d',
                            'pty,b9600,CSIZE=CS7,PARENB=0,PARODD=0,raw,echo=0,link=/dev/ttyS90',
                            'pty,b9600,CSIZE=CS7,PARENB=0,PARODD=0,raw,echo=0,link=/dev/ttyS91'
                            ])

print("--- subprocess.Popen: mypopen:           ", mypopen)
print("--- subprocess.Popen: mypopen.args:      ", mypopen.args)
print("--- subprocess.Popen: mypopen.pid:       ", mypopen.pid)
print("--- subprocess.Popen: mypopen.poll:      ", mypopen.poll())
#~print("--- subprocess.Popen: wait:              ", mypopen.wait(timeout=4))
#~print("--- subprocess.Popen: communicate        ", mypopen.communicate(timeout=2))
#~print("--- subprocess.Popen: communicate[0]     ", mypopen.communicate()[0])
#~print("--- subprocess.Popen: mypopen.stdin:     ", mypopen.stdin)
#~print("--- subprocess.Popen: mypopen.stdout:    ", mypopen.stdout)
#~print("--- subprocess.Popen: mypopen.stderr:    ", mypopen.stderr)
#~print("--- subprocess.Popen: mypopen.returncode:", mypopen.returncode) # result is None as long as process still running

time.sleep(0.005) # socat needs ~0.001 sec to complete its action; but then keeps running
print("\nListing permissions:")
try:
    print("   /dev/ttyS90: ", oct(os.stat('/dev/ttyS90')[0]))
    print("   /dev/ttyS90: ", oct(os.stat('/dev/ttyS90')[0]))
except Exception as e:
    print("Listing permissions failed with Exception: ", e)
    print("??????????   Forgot to start program with 'sudo'  ???????????\n\n")
    sys.exit()


print("\n--- Changing permission with os.chmod on: ", '/dev/ttyS90', '/dev/ttyS91', 'to 0o777')
start = time.time()
while True:
    try:
        os.chmod('/dev/ttyS90', 0o777)
        os.chmod('/dev/ttyS91', 0o777)
        break
    except:
        pass
print("--- success after {:0.3f} ms".format((time.time() - start) * 1000))

print("\nListing permissions:")
print("   /dev/ttyS90: ", oct(os.stat('/dev/ttyS90')[0]))
print("   /dev/ttyS90: ", oct(os.stat('/dev/ttyS90')[0]))

print("\nList of Ports found on system (including linked ports): ")
lps = serial.tools.list_ports.comports(include_links=True)
for lp in lps:  print(" ", lp)


v1_result = b'\r\nStandard'
v2_result = b'\r\nVersion 6.10 d93683 4f07 19.08.19 21:20:01'  # from the GSsimData
P_result  = b'\r\nPC-Mode gestartet'
X_result  = b'\r\nPC-Mode beendet'
b_result  = b'\r\n' + (dumpdata.replace("\n", "\r\n")).encode("UTF-8")

start       = time.time()
counter     = 0
NormalMode  = True
portsim     = "/dev/ttyS90"

#
# for use of spy see: https://pyserial.readthedocs.io/en/latest/url_handlers.html
#
wser        = serial.serial_for_url("spy://{}?file=GLgammascoutsim.log".format(portsim), baudrate=9600, bytesize=7, parity="E", timeout=0.1)

print("\nwser: ", wser)

while True :
    counter += 1

    rres = wser.readline()
    #~if rres != b'': print("rres: ", rres)

    print(".", end="", flush=True)

    if counter % 100 == 0:
        print(" Loop100: {:0.1f} sec".format((time.time() - start) ))
        start = time.time()

    if rres > b"":
        counter = 0

        if   rres == b"v" and NormalMode:               # b'\r\nStandard'
            tag = v1_result

        elif rres == b"v" and not NormalMode:           # b'\r\nVersion 6.10 d93683 4f07 19.08.19 21:20:01'
            tag = v2_result

        elif rres == b"P":                              # b'\r\nPC-Mode gestartet'
            tag = P_result
            NormalMode = False

        elif rres == b"X" and NormalMode:               # b"\r\n"
            tag = b"\r\n"
            NormalMode = True

        elif rres == b"X" and not NormalMode:           # b'\r\nPC-Mode beendet'
            tag = X_result
            NormalMode = True

        elif rres == b"b" and not NormalMode:           # b'\r\n' + (dumpdata.replace("\n", "\r\n")).encode("UTF-8")
            tag = b_result

        else:                                           # b"\r\nnot recognized"
            tag = b"\r\nnot recognized"

        wser.write(tag)
        print()
        print("Received : {:30s}  on port '{}'".format(str(rres), portsim ))
        print("Answered : {} ".format(tag))


    #time.sleep(0.01) # not needed; the RX timeout of 0.1 sec makes the delay


